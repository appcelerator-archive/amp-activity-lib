{
  "version": 3,
  "sources": [
    "../../src/test/index.js"
  ],
  "names": [],
  "mappings": ";;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,MAAM,SAAS,eAAK,MAApB;;AAEA,SAAS,KAAT,CAAe,cAAf,EAA+B;AAC7B,SAAO,IAAI,OAAJ,CAAa,OAAD,IAAa;AAC9B,eAAW,MAAK;AACd;AACD,KAFD,EAEG,iBAAiB,IAFpB;AAGD,GAJM,CAAP;AAKD;;AAED,SAAS,iBAAT,GAA6B;AAC3B,SAAO,IAAI,OAAJ,CAAY,CAAC,OAAD,EAAU,MAAV,KAAqB;AACtC,sBAAQ,GAAR,CAAY,4CAAZ,EAA0D,GAA1D,CAA+D,QAAD,IAAa;AACzE,UAAI,SAAS,KAAb,EAAoB;AAClB,eAAO,OAAO,SAAS,KAAhB,CAAP;AACD;AACD,UAAI,SAAS,MAAT,IAAmB,GAAvB,EAA4B;AAC1B,eAAO,OAAO,cAAP,CAAP;AACD;AACD;AACD,KARD;AASD,GAVM,CAAP;AAWD;;AAED,SAAS,UAAT,EAAqB,YAAW;AAC9B,QAAM,SAAS,0BAAf;;AAEA,SAAO,iBAAP;AAAA,gCAA0B,WAAe,IAAf,EAAqB;AAC7C,WAAK,OAAL,CAAa,KAAK,IAAlB;;AAEA,UAAI,UAAU,KAAd;AACA,WAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,EAApB,EAAwB,GAAxB,EAA6B;AAC3B,YAAI;AACF,gBAAM,mBAAN;AACA,oBAAU,IAAV;AACA;AACD,SAJD,CAIE,OAAO,GAAP,EAAY;;AAEZ,gBAAM,MAAM,CAAN,CAAN;AACD;AACF;;AAED,UAAI,OAAJ,EAAa;AACX;AACD,OAFD,MAEO;AACL,aAAK,8BAAL;AACD;AACF,KApBD;;AAAA;AAAA;AAAA;AAAA;;AAsBA,KAAG,sDAAH;AAAA,gCAA2D,WAAM,IAAN,EAAe;AACxE,UAAI;AACF,cAAM,OAAO,EAAE,MAAM,MAAR,EAAb;AACA,cAAM,WAAW,MAAM,mBAAS,WAAT,CAAqB,MAArB,CAAvB;AACA,cAAM,SAAS,IAAT,CAAc,IAAd,CAAN;AACA,cAAM,QAAQ,MAAM,OAAO,GAAP,CAAW,SAAS,EAApB,CAApB;AACA,eAAO,KAAK,KAAL,CAAW,MAAM,KAAjB,EAAwB,IAA/B,EAAqC,EAArC,CAAwC,IAAxC,CAA6C,KAA7C,CAAmD,IAAnD;AACA;AACD,OAPD,CAOE,OAAO,GAAP,EAAY;AACZ,aAAK,GAAL;AACD;AACF,KAXD;;AAAA;AAAA;AAAA;AAAA;AAYD,CArCD",
  "file": "index.js",
  "sourcesContent": [
    "import chai from 'chai'\nimport unirest from 'unirest'\nimport Activity from '../Activity'\nimport { Consul } from 'amp-consul-lib'\n\nconst expect = chai.expect\n\nfunction sleep(delayInSeconds) {\n  return new Promise((resolve) => {\n    setTimeout(()=> {\n      resolve()\n    }, delayInSeconds * 1000)\n  })\n}\n\nfunction consulHealthCheck() {\n  return new Promise((resolve, reject) => {\n    unirest.get('http://consul:8500/v1/health/checks/consul').end((response)=> {\n      if (response.error) {\n        return reject(response.error)\n      }\n      if (response.status == 401) {\n        return reject('Unauthorized')\n      }\n      resolve()\n    })\n  })\n}\n\ndescribe('Activity', function() {\n  const consul = new Consul()\n\n  before('Wait for consul', async function(done) {\n    this.timeout(10 * 1000)\n\n    let success = false\n    for (let i = 0; i < 10; i++) {\n      try {\n        await consulHealthCheck()\n        success = true\n        break\n      } catch (err) {\n        // Ignore error and wait\n        await sleep(1)\n      }\n    }\n\n    if (success) {\n      done()\n    } else {\n      done('Timed out waiting for consul')\n    }\n  })\n\n  it('details should be available in consul after creation', async(done) => {\n    try {\n      const data = { test: 'data' }\n      const activity = await Activity.newActivity('test')\n      await activity.save(data)\n      const value = await consul.get(activity.id)\n      expect(JSON.parse(value.Value).data).to.deep.equal(data)\n      done()\n    } catch (err) {\n      done(err)\n    }\n  })\n})\n"
  ]
}