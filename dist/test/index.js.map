{
  "version": 3,
  "sources": [
    "index.js"
  ],
  "names": [],
  "mappings": ";;AAAA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA,IAAM,SAAS,eAAK,MAApB;;AAEA,SAAS,KAAT,CAAe,cAAf,EAA+B;AAC7B,SAAO,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAa;AAC9B,eAAW,YAAK;AACd;AACD,KAFD,EAEG,iBAAiB,IAFpB;AAGD,GAJM,CAAP;AAKD;;AAED,SAAS,iBAAT,GAA6B;AAC3B,SAAO,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAU,MAAV,EAAqB;AACtC,sBAAQ,GAAR,CAAY,4CAAZ,EAA0D,GAA1D,CAA8D,UAAC,QAAD,EAAa;AACzE,UAAI,SAAS,KAAb,EAAoB;AAClB,eAAO,OAAO,SAAS,KAAhB,CAAP;AACD;AACD,UAAI,SAAS,MAAT,IAAmB,GAAvB,EAA4B;AAC1B,eAAO,OAAO,cAAP,CAAP;AACD;AACD;AACD,KARD;AASD,GAVM,CAAP;AAWD;;AAED,SAAS,UAAT,EAAqB,YAAW;AAAA;;AAC9B,MAAM,SAAS,0BAAf;;AAEA,SAAO,iBAAP,EAA0B,iBAAe,IAAf;AAAA,QAGpB,OAHoB,EAIf,CAJe;AAAA;AAAA;AAAA;AAAA;AACxB,iBAAK,OAAL,CAAa,KAAK,IAAlB;;AAEI,mBAHoB,GAGV,KAHU;AAIf,aAJe,GAIX,CAJW;;AAAA;AAAA,kBAIR,IAAI,EAJI;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,4CAMd,mBANc;;AAAA;AAOpB,sBAAU,IAAV;AAPoB;;AAAA;AAAA;AAAA;AAAA;AAAA,4CAWd,MAAM,CAAN,CAXc;;AAAA;AAIA,eAJA;AAAA;AAAA;;AAAA;;AAexB,gBAAI,OAAJ,EAAa;AACX;AACD,aAFD,MAEO;AACL,mBAAK,8BAAL;AACD;;AAnBuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAA1B;;AAsBA,KAAG,sDAAH,EAA2D,kBAAM,IAAN;AAAA,QAEjD,IAFiD,EAGjD,QAHiD,EAKjD,KALiD;AAAA;AAAA;AAAA;AAAA;AAAA;AAEjD,gBAFiD,GAE1C,EAAE,MAAM,MAAR,EAF0C;AAAA;AAAA,4CAGhC,mBAAS,WAAT,CAAqB,MAArB,CAHgC;;AAAA;AAGjD,oBAHiD;AAAA;AAAA,4CAIjD,SAAS,IAAT,CAAc,IAAd,CAJiD;;AAAA;AAAA;AAAA,4CAKnC,OAAO,GAAP,CAAW,SAAS,EAApB,CALmC;;AAAA;AAKjD,iBALiD;;AAMvD,mBAAO,KAAK,KAAL,CAAW,MAAM,KAAjB,EAAwB,IAA/B,EAAqC,EAArC,CAAwC,IAAxC,CAA6C,KAA7C,CAAmD,IAAnD;AACA;AAPuD;AAAA;;AAAA;AAAA;AAAA;;AASvD;;AATuD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAA3D;AAYD,CArCD",
  "file": "index.js",
  "sourcesContent": [
    "import 'babel-polyfill'\nimport chai from 'chai'\nimport unirest from 'unirest'\nimport Activity from '../Activity'\nimport { Consul } from 'amp-consul-lib'\n\nconst expect = chai.expect\n\nfunction sleep(delayInSeconds) {\n  return new Promise((resolve) => {\n    setTimeout(()=> {\n      resolve()\n    }, delayInSeconds * 1000)\n  })\n}\n\nfunction consulHealthCheck() {\n  return new Promise((resolve, reject) => {\n    unirest.get('http://consul:8500/v1/health/checks/consul').end((response)=> {\n      if (response.error) {\n        return reject(response.error)\n      }\n      if (response.status == 401) {\n        return reject('Unauthorized')\n      }\n      resolve()\n    })\n  })\n}\n\ndescribe('Activity', function() {\n  const consul = new Consul()\n\n  before('Wait for consul', async function(done) {\n    this.timeout(10 * 1000)\n\n    let success = false\n    for (let i = 0; i < 10; i++) {\n      try {\n        await consulHealthCheck()\n        success = true\n        break\n      } catch (err) {\n        // Ignore error and wait\n        await sleep(1)\n      }\n    }\n\n    if (success) {\n      done()\n    } else {\n      done('Timed out waiting for consul')\n    }\n  })\n\n  it('details should be available in consul after creation', async(done) => {\n    try {\n      const data = { test: 'data' }\n      const activity = await Activity.newActivity('test')\n      await activity.save(data)\n      const value = await consul.get(activity.id)\n      expect(JSON.parse(value.Value).data).to.deep.equal(data)\n      done()\n    } catch (err) {\n      done(err)\n    }\n  })\n})\n"
  ]
}